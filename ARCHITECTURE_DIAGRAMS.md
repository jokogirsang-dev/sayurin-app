# ğŸ¨ HORTASIMA ARCHITECTURE DIAGRAMS & FLOW CHARTS

## 1ï¸âƒ£ OVERALL APPLICATION ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PRESENTATION LAYER (UI)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Customer App  â”‚  â”‚   Admin App    â”‚  â”‚  Settings/Profile â”‚          â”‚
â”‚  â”‚  (15 pages)    â”‚  â”‚   (Dashboard)  â”‚  â”‚  (Shared)        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE MANAGEMENT LAYER (Providers)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  UserProviderâ”‚  â”‚ CartProvider â”‚  â”‚ProdukProviderâ”‚  â”‚PesananProv.â”‚ â”‚
â”‚  â”‚  (Auth/Role) â”‚  â”‚  (Shopping)  â”‚  â”‚ (Catalog)    â”‚  â”‚ (Orders)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MIDDLEWARE LAYER (Protection & Validation)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  AuthMiddleware  â”‚        â”‚  RoleMiddleware  â”‚                      â”‚
â”‚  â”‚  - JWT verify    â”‚        â”‚  - RBAC check    â”‚                      â”‚
â”‚  â”‚  - Token refresh â”‚        â”‚  - Permission    â”‚                      â”‚
â”‚  â”‚  - User extract  â”‚        â”‚  - Route guard   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVICE LAYER (Business Logic & API)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ApiService    â”‚  â”‚ ProdukService  â”‚  â”‚ PesananService   â”‚          â”‚
â”‚  â”‚ (HTTP Client)  â”‚  â”‚ (Product API)  â”‚  â”‚ (Order API)      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  UTILITIES & CONSTANTS (Cross-Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Constants  â”‚  â”‚   Validators â”‚  â”‚ DateFormatterâ”‚                  â”‚
â”‚  â”‚  Errors      â”‚  â”‚  Errors      â”‚  â”‚ ErrorHandler â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA LAYER (API & Local Storage)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚     Backend API (Node.js)    â”‚  â”‚  Local Storage (SQLite)     â”‚       â”‚
â”‚  â”‚  â”œâ”€ /api/v1/auth            â”‚  â”‚  â”œâ”€ Cached products        â”‚       â”‚
â”‚  â”‚  â”œâ”€ /api/v1/products        â”‚  â”‚  â”œâ”€ Cached orders          â”‚       â”‚
â”‚  â”‚  â”œâ”€ /api/v1/orders          â”‚  â”‚  â””â”€ Secure tokens          â”‚       â”‚
â”‚  â”‚  â””â”€ /api/v1/payments        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ AUTHENTICATION FLOW

```
START: User Opens App
  â”‚
  â”œâ”€ Check Local Storage for token
  â”‚  â”œâ”€ âœ… Token found
  â”‚  â”‚  â””â”€ AuthMiddleware.verifyToken()
  â”‚  â”‚     â”œâ”€ âœ… Valid (not expired) â†’ Extract user info â†’ Go to Home
  â”‚  â”‚     â””â”€ âŒ Expired â†’ Refresh token
  â”‚  â”‚        â”œâ”€ âœ… Refresh OK â†’ Update storage â†’ Go to Home
  â”‚  â”‚        â””â”€ âŒ Refresh failed â†’ Clear storage â†’ Go to Login
  â”‚  â”‚
  â”‚  â””â”€ âŒ No token found â†’ Go to Login Page
  â”‚
  â”œâ”€ User enters email & password
  â”‚  â””â”€ Validators.validateForm()
  â”‚     â”œâ”€ âœ… Valid â†’ Continue
  â”‚     â””â”€ âŒ Invalid â†’ Show error messages
  â”‚
  â”œâ”€ Call ApiService.login()
  â”‚  â””â”€ ErrorHandler catches errors
  â”‚     â”œâ”€ Network error â†’ Show "Koneksi terputus"
  â”‚     â”œâ”€ Invalid credentials â†’ Show "Email atau password salah"
  â”‚     â””â”€ Server error â†’ Show "Server error"
  â”‚
  â”œâ”€ Receive JWT token from server
  â”‚  â””â”€ AuthMiddleware.verifyToken()
  â”‚     â”œâ”€ âœ… Valid â†’ Extract user info
  â”‚     â””â”€ âŒ Invalid â†’ Show "Token tidak valid"
  â”‚
  â”œâ”€ Store token securely in local storage
  â”‚  â””â”€ LocalStorageService.saveToken()
  â”‚
  â”œâ”€ Extract role from JWT
  â”‚  â””â”€ RoleMiddleware.isAdmin() or .isCustomer()
  â”‚
  â””â”€ Navigate to appropriate home
     â”œâ”€ Admin â†’ /admin-dashboard
     â””â”€ Customer â†’ /home
```

---

## 3ï¸âƒ£ REQUEST LIFECYCLE WITH MIDDLEWARE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Action / Navigation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. VALIDATION (validators.dart)            â”‚
â”‚  â”œâ”€ Email validation                        â”‚
â”‚  â”œâ”€ Password strength                       â”‚
â”‚  â”œâ”€ Required fields                         â”‚
â”‚  â””â”€ Custom validations                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. AUTH CHECK (auth_middleware.dart)       â”‚
â”‚  â”œâ”€ Retrieve token from storage             â”‚
â”‚  â”œâ”€ Verify token not expired                â”‚
â”‚  â”œâ”€ Check token signature                   â”‚
â”‚  â”œâ”€ Extract user info (userId, role, email)â”‚
â”‚  â””â”€ If expired â†’ Auto refresh               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ROLE CHECK (role_middleware.dart)       â”‚
â”‚  â”œâ”€ Get user role from token                â”‚
â”‚  â”œâ”€ Check route access (customer vs admin)  â”‚
â”‚  â”œâ”€ Check permission for action             â”‚
â”‚  â””â”€ Enforce access (throw exception if no)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ALLOWED â”‚      â”‚ âŒ DENIED  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â–¼                   â–¼
  Proceed to        Show Error
  API Call          Message
       â”‚            "Anda tidak
       â”‚             memiliki
       â–¼             akses"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. API CALL (api_service.dart - NEXT)      â”‚
â”‚  â”œâ”€ Add token to headers                    â”‚
â”‚  â”œâ”€ Send request to backend                 â”‚
â”‚  â”œâ”€ Handle response/error                   â”‚
â”‚  â””â”€ Log request/response                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ERROR HANDLING (error_handler.dart)     â”‚
â”‚  â”œâ”€ Parse HTTP error                        â”‚
â”‚  â”œâ”€ Map to error code                       â”‚
â”‚  â”œâ”€ Generate user-friendly message          â”‚
â”‚  â”œâ”€ Log error for debugging                 â”‚
â”‚  â””â”€ Suggest retry if network error          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. RESPONSE HANDLING                       â”‚
â”‚  â”œâ”€ Update local state (Provider)           â”‚
â”‚  â”œâ”€ Cache data locally (SQLite)             â”‚
â”‚  â”œâ”€ Update UI (Consumer/listener)           â”‚
â”‚  â””â”€ Show success/error message              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ ROLE-BASED ACCESS CONTROL (RBAC) MATRIX

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature/Action     â”‚ Customer â”‚  Admin  â”‚ Super Admin  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW HOME          â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SEARCH PRODUCTS    â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW PRODUCT       â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MANAGE CART        â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CHECKOUT           â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CREATE ORDER       â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW OWN ORDERS    â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LEAVE REVIEW       â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EDIT PROFILE       â”‚    âœ…    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW DASHBOARD     â”‚    âŒ    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MANAGE PRODUCTS    â”‚    âŒ    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MANAGE ORDERS      â”‚    âŒ    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW REPORTS       â”‚    âŒ    â”‚   âœ…    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MANAGE USERS       â”‚    âŒ    â”‚   âŒ    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MANAGE ROLES       â”‚    âŒ    â”‚   âŒ    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VIEW ANALYTICS     â”‚    âŒ    â”‚   âŒ    â”‚      âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SYSTEM SETTINGS    â”‚    âŒ    â”‚   âŒ    â”‚      âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ JWT TOKEN LIFECYCLE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login Request   â”‚
â”‚  (email/pwd)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: Generate JWT       â”‚
â”‚  Header: {alg: HS256, ...}   â”‚
â”‚  Payload: {userId, email,    â”‚
â”‚            role, iat, exp}   â”‚
â”‚  Signature: HMAC-SHA256      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: Receive Token     â”‚
â”‚  eyJhbGc...eyJlbWFpbC...    â”‚
â”‚  (Base64 encoded)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store in Local Storage      â”‚
â”‚  (SharedPreferences)         â”‚
â”‚  Encrypted & secured         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚          â”‚
    â–¼          â–¼
Immediate   Check if
Use         Needs Refresh
    â”‚          â”‚
    â”‚          â”œâ”€ Token < 5 min left?
    â”‚          â”‚  â”œâ”€ YES â†’ Refresh before expiry
    â”‚          â”‚  â””â”€ NO â†’ Continue using
    â”‚          â”‚
    â”‚          â””â”€ Token expired?
    â”‚             â”œâ”€ YES â†’ Refresh immediately
    â”‚             â””â”€ NO â†’ Continue using
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Use in Request Headers      â”‚
â”‚  Authorization: Bearer <JWT> â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: Verify Token       â”‚
â”‚  â”œâ”€ Check signature          â”‚
â”‚  â”œâ”€ Check expiration         â”‚
â”‚  â”œâ”€ Extract user info        â”‚
â”‚  â””â”€ Process request          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
    â–¼           â–¼
âœ… Valid    âŒ Invalid/Expired
    â”‚           â”‚
    â”‚           â””â”€â†’ Return 401
    â”‚              Frontend â†’ Refresh/Logout
    â”‚
    â–¼
Frontend: AuthMiddleware
  â”œâ”€ JwtDecoder.decode(token)
  â”œâ”€ Get exp time
  â”œâ”€ Extract payload
  â””â”€ Use for auth checks
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auto Refresh (If needed)    â”‚
â”‚  Call /api/v1/auth/refresh   â”‚
â”‚  Send: {refreshToken}        â”‚
â”‚  Get: {accessToken}          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Storage              â”‚
â”‚  Save new token              â”‚
â”‚  Continue with new token     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6ï¸âƒ£ ERROR HANDLING FLOW

```
Operation (API Call / Form Submit)
  â”‚
  â”œâ”€ Try
  â”‚  â””â”€ Execute operation
  â”‚     â”œâ”€ Network call
  â”‚     â”œâ”€ Local computation
  â”‚     â””â”€ Database operation
  â”‚
  â”œâ”€ Catch (Error occurs)
  â”‚  â”‚
  â”‚  â”œâ”€ Is it AppException?
  â”‚  â”‚  â”œâ”€ YES â†’ Use as-is
  â”‚  â”‚  â””â”€ NO â†’ ErrorHandler.handleError()
  â”‚  â”‚
  â”‚  â”œâ”€ Parse error type
  â”‚  â”‚  â”œâ”€ DioException (HTTP)
  â”‚  â”‚  â”‚  â””â”€ Map HTTP status â†’ Error code
  â”‚  â”‚  â”‚     â”œâ”€ 400 â†’ INVALID_REQUEST
  â”‚  â”‚  â”‚     â”œâ”€ 401 â†’ UNAUTHORIZED
  â”‚  â”‚  â”‚     â”œâ”€ 403 â†’ FORBIDDEN
  â”‚  â”‚  â”‚     â”œâ”€ 404 â†’ NOT_FOUND
  â”‚  â”‚  â”‚     â”œâ”€ 500 â†’ SERVER_ERROR
  â”‚  â”‚  â”‚     â””â”€ etc.
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ FormatException
  â”‚  â”‚  â”‚  â””â”€ INVALID_FORMAT
  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€ Unknown
  â”‚  â”‚     â””â”€ UNKNOWN_ERROR
  â”‚  â”‚
  â”‚  â”œâ”€ Generate user-friendly message
  â”‚  â”‚  â”œâ”€ In Indonesian
  â”‚  â”‚  â”œâ”€ No technical details
  â”‚  â”‚  â””â”€ Actionable ("Coba lagi", "Periksa koneksi", etc.)
  â”‚  â”‚
  â”‚  â”œâ”€ Log error (for debugging)
  â”‚  â”‚  â”œâ”€ Error code
  â”‚  â”‚  â”œâ”€ Error message
  â”‚  â”‚  â”œâ”€ Stack trace
  â”‚  â”‚  â””â”€ Timestamp
  â”‚  â”‚
  â”‚  â””â”€ Check if retryable
  â”‚     â”œâ”€ Network timeout â†’ YES (with backoff)
  â”‚     â”œâ”€ No internet â†’ YES (with backoff)
  â”‚     â”œâ”€ Server error â†’ YES (with backoff)
  â”‚     â”œâ”€ Invalid input â†’ NO (show form errors)
  â”‚     â””â”€ Unauthorized â†’ NO (redirect to login)
  â”‚
  â””â”€ Finally
     â”œâ”€ Clean up resources
     â”œâ”€ Stop loading indicator
     â””â”€ Update UI state
```

---

## 7ï¸âƒ£ USER JOURNEY: CUSTOMER

```
START
  â”‚
  â”œâ”€ ğŸš€ ONBOARDING
  â”‚  â”œâ”€ Welcome/Splash Screen
  â”‚  â”œâ”€ Check for saved token
  â”‚  â”‚  â”œâ”€ YES â†’ Jump to step 4
  â”‚  â”‚  â””â”€ NO â†’ Continue
  â”‚  â””â”€ See Login/Register options
  â”‚
  â”œâ”€ ğŸ“ AUTHENTICATION (FIRST TIME)
  â”‚  â”œâ”€ Login / Register
  â”‚  â”œâ”€ JWT token received
  â”‚  â”œâ”€ Token stored securely
  â”‚  â””â”€ Navigate to home
  â”‚
  â”œâ”€ ğŸ  HOME PAGE
  â”‚  â”œâ”€ Display featured products
  â”‚  â”œâ”€ Flash sale countdown (formatFlashSaleCountdown)
  â”‚  â”œâ”€ Category section
  â”‚  â””â”€ Recent order history
  â”‚
  â”œâ”€ ğŸ” SEARCH & BROWSE
  â”‚  â”œâ”€ Search by keyword
  â”‚  â”œâ”€ Filter by category/price
  â”‚  â”œâ”€ View product list
  â”‚  â””â”€ Apply validators for search input
  â”‚
  â”œâ”€ ğŸ“¦ VIEW PRODUCT DETAIL
  â”‚  â”œâ”€ Product info & images
  â”‚  â”œâ”€ Price & stock
  â”‚  â”œâ”€ Customer reviews
  â”‚  â”œâ”€ Related products
  â”‚  â””â”€ "Add to cart" button
  â”‚
  â”œâ”€ ğŸ›’ MANAGE CART
  â”‚  â”œâ”€ Add item to cart
  â”‚  â”œâ”€ Update quantity (with validators)
  â”‚  â”œâ”€ Remove items
  â”‚  â”œâ”€ View total price
  â”‚  â””â”€ Proceed to checkout
  â”‚
  â”œâ”€ ğŸ’³ CHECKOUT & PAYMENT
  â”‚  â”œâ”€ Enter shipping address
  â”‚  â”‚  â””â”€ Validate address fields
  â”‚  â”œâ”€ Select delivery method
  â”‚  â”œâ”€ Apply promo code
  â”‚  â”‚  â””â”€ Validate promo code
  â”‚  â”œâ”€ Payment method selection
  â”‚  â”‚  â”œâ”€ Credit/Debit card
  â”‚  â”‚  â”œâ”€ E-wallet
  â”‚  â”‚  â””â”€ Bank transfer
  â”‚  â””â”€ Confirm payment
  â”‚
  â”œâ”€ âœ… ORDER CONFIRMATION
  â”‚  â”œâ”€ Order number generated
  â”‚  â”‚  â””â”€ formatInvoiceNumber()
  â”‚  â”œâ”€ Order total with timestamp
  â”‚  â”‚  â””â”€ formatDateTime()
  â”‚  â”œâ”€ Estimated delivery
  â”‚  â”‚  â””â”€ formatDeliveryTime()
  â”‚  â””â”€ View order details
  â”‚
  â”œâ”€ ğŸ“ ORDER TRACKING
  â”‚  â”œâ”€ View order status:
  â”‚  â”‚  â”œâ”€ Diproses (Processing)
  â”‚  â”‚  â”œâ”€ Dikemas (Packing)
  â”‚  â”‚  â”œâ”€ Dikirim (Shipped)
  â”‚  â”‚  â””â”€ Selesai (Delivered)
  â”‚  â”œâ”€ Time stamps for each status
  â”‚  â”‚  â””â”€ formatOrderTime()
  â”‚  â”œâ”€ Track shipment
  â”‚  â””â”€ Contact seller
  â”‚
  â”œâ”€ â­ LEAVE REVIEW
  â”‚  â”œâ”€ Rate product (1-5 stars)
  â”‚  â”œâ”€ Write text review
  â”‚  â”‚  â””â”€ Validate review length
  â”‚  â”œâ”€ Upload photos
  â”‚  â””â”€ Submit review
  â”‚
  â”œâ”€ ğŸ‘¤ MANAGE PROFILE
  â”‚  â”œâ”€ View personal info
  â”‚  â”œâ”€ Update profile
  â”‚  â”‚  â””â”€ Validate name, phone, email
  â”‚  â”œâ”€ Manage addresses
  â”‚  â”œâ”€ Payment methods
  â”‚  â””â”€ Preferences
  â”‚
  â”œâ”€ ğŸ“‹ VIEW ORDER HISTORY
  â”‚  â”œâ”€ List all past orders
  â”‚  â”œâ”€ Filter by status/date
  â”‚  â”œâ”€ Time formatting
  â”‚  â”‚  â””â”€ formatRelativeTime() "2 hari yang lalu"
  â”‚  â””â”€ Reorder options
  â”‚
  â””â”€ ğŸšª LOGOUT
     â”œâ”€ Clear token from storage
     â”œâ”€ Clear cached data
     â””â”€ Return to login page
```

---

## 8ï¸âƒ£ USER JOURNEY: ADMIN

```
START (After admin login)
  â”‚
  â”œâ”€ ğŸ“Š ADMIN DASHBOARD
  â”‚  â”œâ”€ Sales overview
  â”‚  â”œâ”€ Order statistics
  â”‚  â”œâ”€ Revenue chart
  â”‚  â”œâ”€ Top selling products
  â”‚  â””â”€ Recent activities
  â”‚
  â”œâ”€ ğŸ“¦ PRODUCT MANAGEMENT
  â”‚  â”œâ”€ View all products (paginated)
  â”‚  â”œâ”€ Add new product
  â”‚  â”‚  â””â”€ Validate fields:
  â”‚  â”‚     â”œâ”€ Name (minLength)
  â”‚  â”‚     â”œâ”€ Price (isNumeric & > 0)
  â”‚  â”‚     â”œâ”€ Stock (isNumeric & >= 0)
  â”‚  â”‚     â””â”€ Images (isUrl)
  â”‚  â”œâ”€ Edit product details
  â”‚  â”œâ”€ Update stock
  â”‚  â”œâ”€ Delete product (SUPER_ADMIN only)
  â”‚  â””â”€ Upload images
  â”‚
  â”œâ”€ ğŸ“‹ ORDER MANAGEMENT
  â”‚  â”œâ”€ View all orders
  â”‚  â”‚  â””â”€ Filter by date/status
  â”‚  â”œâ”€ Update order status:
  â”‚  â”‚  â”œâ”€ Diproses â†’ Dikemas
  â”‚  â”‚  â”œâ”€ Dikemas â†’ Dikirim
  â”‚  â”‚  â””â”€ Dikirim â†’ Selesai
  â”‚  â”œâ”€ View order details
  â”‚  â”œâ”€ Manage shipment
  â”‚  â”œâ”€ Handle returns
  â”‚  â””â”€ Process refunds
  â”‚
  â”œâ”€ ğŸ’¬ CUSTOMER SUPPORT
  â”‚  â”œâ”€ View customer messages
  â”‚  â”œâ”€ Send replies
  â”‚  â”œâ”€ Manage FAQs
  â”‚  â””â”€ View chat history
  â”‚
  â”œâ”€ ğŸ“Š REPORTS & ANALYTICS
  â”‚  â”œâ”€ Sales report
  â”‚  â”‚  â””â”€ Date range filtering with formatDate()
  â”‚  â”œâ”€ Product performance
  â”‚  â”œâ”€ Customer analytics
  â”‚  â”œâ”€ Revenue breakdown
  â”‚  â””â”€ Export reports
  â”‚
  â”œâ”€ ğŸ‘¥ CUSTOMER MANAGEMENT (SUPER_ADMIN)
  â”‚  â”œâ”€ View all customers
  â”‚  â”œâ”€ Customer details
  â”‚  â”œâ”€ View purchase history
  â”‚  â”œâ”€ Manage customer status
  â”‚  â””â”€ Send bulk messages
  â”‚
  â”œâ”€ ğŸ”§ ROLE MANAGEMENT (SUPER_ADMIN)
  â”‚  â”œâ”€ View all roles
  â”‚  â”œâ”€ Create new role
  â”‚  â”œâ”€ Edit role permissions
  â”‚  â”œâ”€ Delete role
  â”‚  â””â”€ Assign roles to users
  â”‚
  â”œâ”€ âš™ï¸ SYSTEM SETTINGS (SUPER_ADMIN)
  â”‚  â”œâ”€ App configuration
  â”‚  â”‚  â””â”€ Update AppConstants values
  â”‚  â”œâ”€ API endpoints
  â”‚  â”œâ”€ Email templates
  â”‚  â”œâ”€ Notification settings
  â”‚  â””â”€ Payment gateway config
  â”‚
  â””â”€ ğŸšª LOGOUT
     â”œâ”€ Clear admin token
     â”œâ”€ Clear cached admin data
     â””â”€ Return to login
```

---

## 9ï¸âƒ£ MIDDLEWARE PROTECTION FLOW

```
User Action / Route Navigation
  â”‚
  â”œâ”€ Check: Is token present?
  â”‚  â”œâ”€ NO â†’ Redirect to /login
  â”‚  â””â”€ YES â†’ Continue
  â”‚
  â”œâ”€ Check: Is token valid?
  â”‚  â”œâ”€ NO â†’ Show error, Redirect to /login
  â”‚  â””â”€ YES â†’ Continue
  â”‚
  â”œâ”€ Check: Is token expired?
  â”‚  â”œâ”€ YES â†’ Try to refresh
  â”‚  â”‚        â”œâ”€ Refresh OK â†’ Continue with new token
  â”‚  â”‚        â””â”€ Refresh failed â†’ Redirect to /login
  â”‚  â””â”€ NO â†’ Continue
  â”‚
  â”œâ”€ Extract user role from token
  â”‚  â””â”€ AuthMiddleware.extractRole(token)
  â”‚
  â”œâ”€ Get user permissions for role
  â”‚  â””â”€ RoleMiddleware._getRolePermissions(role)
  â”‚
  â”œâ”€ Check: Can user access this route?
  â”‚  â”œâ”€ NO â†’ Show "Anda tidak memiliki akses"
  â”‚  â””â”€ YES â†’ Continue
  â”‚
  â”œâ”€ Check: Can user perform this action?
  â”‚  â”œâ”€ NO â†’ Show "Anda tidak memiliki izin"
  â”‚  â””â”€ YES â†’ Continue
  â”‚
  â””â”€ âœ… ALLOWED â†’ Execute action
```

---

## ğŸ”Ÿ PHASE 1 FILE DEPENDENCY DIAGRAM

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   UI Layer       â”‚
                    â”‚  (main.dart)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Providers  â”‚  â”‚   Routes     â”‚  â”‚     Widgets   â”‚
   â”‚             â”‚  â”‚              â”‚  â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Services â”‚    â”‚  Middleware  â”‚    â”‚ Utilities  â”‚
   â”‚          â”‚    â”‚              â”‚    â”‚            â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚    â”‚            â”‚            â”‚    â”‚
        â–¼    â–¼            â–¼            â–¼    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AUTH MIDDLEWARE    ROLE MIDDLEWARE          â”‚
   â”‚ â”œâ”€ verifyToken()   â”œâ”€ hasRole()             â”‚
   â”‚ â”œâ”€ extractUserId() â”œâ”€ hasPermission()      â”‚
   â”‚ â””â”€ extractRole()   â””â”€ canAccessRoute()      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ERROR      â”‚    â”‚ DATE       â”‚    â”‚  VALIDATORS    â”‚
   â”‚ HANDLER    â”‚    â”‚ FORMATTER  â”‚    â”‚                â”‚
   â”‚            â”‚    â”‚            â”‚    â”‚                â”‚
   â”‚ â”œâ”€ handle()â”‚    â”‚ â”œâ”€ format()â”‚    â”‚ â”œâ”€ validate()  â”‚
   â”‚ â”œâ”€ log()   â”‚    â”‚ â””â”€ parse() â”‚    â”‚ â””â”€ compose()   â”‚
   â”‚ â””â”€ retry() â”‚    â”‚            â”‚    â”‚                â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ APP      â”‚    â”‚ CONSTANTS   â”‚    â”‚ API          â”‚
   â”‚ CONSTANTSâ”‚    â”‚             â”‚    â”‚ ENDPOINTS    â”‚
   â”‚          â”‚    â”‚ â”œâ”€ Colors   â”‚    â”‚              â”‚
   â”‚          â”‚    â”‚ â”œâ”€ Spacing  â”‚    â”‚ â”œâ”€ baseUrl   â”‚
   â”‚          â”‚    â”‚ â”œâ”€ Errors   â”‚    â”‚ â”œâ”€ /auth     â”‚
   â”‚          â”‚    â”‚ â”œâ”€ Roles    â”‚    â”‚ â”œâ”€ /products â”‚
   â”‚          â”‚    â”‚ â””â”€ Perms    â”‚    â”‚ â””â”€ /orders   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Backend API     â”‚
                  â”‚  (Node.js/Django)â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ NEXT FILES TO CREATE (PHASE 1 CONTINUATION)

```
PHASE 1 REMAINING:

1. lib/service/api_service.dart
   Dependencies:
   â”œâ”€ Uses: error_handler.dart
   â”œâ”€ Uses: auth_middleware.dart
   â”œâ”€ Uses: api_endpoints.dart
   â””â”€ Used by: All service classes

2. lib/service/local_storage_service.dart
   Dependencies:
   â”œâ”€ Uses: app_constants.dart
   â”œâ”€ Uses: error_handler.dart
   â””â”€ Used by: user_provider.dart

3. Update lib/main.dart
   Dependencies:
   â”œâ”€ Uses: All providers
   â”œâ”€ Uses: All middleware
   â”œâ”€ Uses: error_handler.dart
   â””â”€ Uses: app_routes.dart

4. Refactor lib/routes/app_routes.dart
   Dependencies:
   â”œâ”€ Uses: auth_middleware.dart
   â”œâ”€ Uses: role_middleware.dart
   â”œâ”€ Uses: error_handler.dart
   â””â”€ All UI pages
```

---

**This architecture ensures:**
âœ… Clear separation of concerns
âœ… Easy to test and maintain
âœ… Scalable for future features
âœ… Security best practices
âœ… User-friendly error handling
âœ… Role-based access control
âœ… Production-ready code quality
